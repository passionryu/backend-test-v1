# 🚀 결제 도메인 서버 구현 TODO 리스트

## 📋 과제 요구사항 분석

README.md를 기반으로 분석한 결과, 다음과 같은 주요 구현 과제가 있습니다:

### 핵심 과제 3가지
1. **결제 생성 API** - TestPg 연동 + 제휴사별 수수료 정책 적용
2. **결제 내역 조회 API** - 통계 포함 + 커서 기반 페이지네이션  
3. **제휴사별 수수료 정책** - 하드코드 제거 + 정책 테이블 기반

---

## 🎯 구현 우선순위별 TODO 리스트

### 🔥 **1단계: 핵심 기능 구현 (필수)**

#### 1.1 TestPg API 연동 구현
- [x] **TestPg API 문서 분석** ([참고자료](https://api-test-pg.bigs.im/docs/index.html))
- [x] **external/pg-client 모듈에 TestPg 어댑터 구현**
- [x] **PgClientOutPort 인터페이스 구현체 작성**
- [x] **REST API 호출 로직 구현**
- [x] **에러 처리 및 재시도 로직 추가**

#### 1.2 결제 생성 API 완성
- [x] **PaymentService 하드코드 수수료 계산 제거**
- [x] **제휴사별 수수료 정책 조회 로직 구현**
- [x] **FeeCalculator에 HALF_UP 반올림 적용**
- [x] **PaymentController POST /api/v1/payments 완성**
- [x] **결제 승인 → 수수료 계산 → 저장 플로우 검증**

#### 1.3 결제 내역 조회 API 구현
- [x] **QueryPaymentsService 구현 완성**
- [x] **PaymentController GET /api/v1/payments 완성**
- [x] **쿼리 파라미터 처리 (partnerId, status, from, to, cursor, limit)**
- [x] **응답 DTO 설계 (items, summary, nextCursor, hasNext)**

#### 1.4 커서 기반 페이지네이션 구현
- [x] **Cursor 클래스 설계 및 구현**
- [x] **정렬 키 기반 페이지네이션 (createdAt desc, id desc)**
- [x] **다음 페이지 존재 여부 판단 로직**
- [x] **커서 인코딩/디코딩 로직**

#### 1.5 통계 기능 구현
- [x] **PaymentSummaryFilter 구현**
- [x] **PaymentSummaryProjection 구현**
- [x] **필터와 동일한 집합 대상 통계 계산**
- [x] **count, totalAmount, totalNetAmount 집계**

---

### 🔒 **2단계: 보안 및 품질**

#### 2.1 보안 처리
- [ ] **카드번호 마스킹 검증**
- [ ] **민감정보 로깅 방지 확인**
- [ ] **입력값 검증 및 예외 처리**

#### 2.2 코드 품질
- [ ] **ktlint 코드 스타일 검사 통과**
- [ ] **코드 리뷰 및 리팩터링**
- [ ] **KDoc 문서화**

#### 2.3 성능 최적화
- [ ] **쿼리 성능 분석**
- [ ] **인덱스 효율성 검증**
- [ ] **메모리 사용량 최적화**

---

## 🎯 **선택 과제 (가산점)**

### 추가 기능 구현
- [ ] **추가 제휴사 연동 (Adapter 추가)**
- [ ] **오픈API 문서화 (springdoc)**
- [ ] **운영지표 및 로깅**
- [ ] **MariaDB 외부 DB 전환**
- [ ] **Docker 컨테이너화**

---

## 📝 **개발 가이드라인**

### 아키텍처 원칙
- ✅ **헥사고널 아키텍처 유지**
- ✅ **포트-어댑터 패턴 준수**
- ✅ **의존성 역전 원칙 적용**
- ✅ **도메인 계층 순수성 유지**

### 코딩 스타일
- ✅ **Kotlin 코딩 컨벤션 준수**
- ✅ **ktlint 자동 포맷팅 적용**
- ✅ **의미있는 네이밍 사용**
- ✅ **적절한 KDoc 문서화**

### 테스트 원칙
- ✅ **빠르고 결정적인 테스트**
- ✅ **높은 테스트 커버리지**
- ✅ **단위/통합/엔드투엔드 테스트 균형**
- ✅ **Mock 객체 적절한 활용**

---

## 🚨 **주의사항**

1. **프로젝트가 현재 정상 동작하지 않음** - 모든 기능을 처음부터 구현해야 함
2. **질문 불가** - 문서와 코드만으로 해결해야 함
3. **면접 코드리뷰** - 깔끔한 커밋 히스토리와 코드 품질 중요
4. **아키텍처 일관성** - 모듈 경계와 의존성 방향 준수 필수

---

*마지막 업데이트: 2025년 10월 18일*
