# 🚀 결제 도메인 서버 구현 TODO 리스트

## 📋 과제 요구사항 분석

README.md를 기반으로 분석한 결과, 다음과 같은 주요 구현 과제가 있습니다:

### 핵심 과제 3가지
1. **결제 생성 API** - TestPg 연동 + 제휴사별 수수료 정책 적용
2. **결제 내역 조회 API** - 통계 포함 + 커서 기반 페이지네이션  
3. **제휴사별 수수료 정책** - 하드코드 제거 + 정책 테이블 기반

---

## 🎯 구현 우선순위별 TODO 리스트

### 🔥 **1단계: 핵심 기능 구현 (필수)**

#### 1.1 TestPg API 연동 구현
- [ ] **TestPg API 문서 분석** ([참고자료](https://api-test-pg.bigs.im/docs/index.html))
- [ ] **external/pg-client 모듈에 TestPg 어댑터 구현**
- [ ] **PgClientOutPort 인터페이스 구현체 작성**
- [ ] **REST API 호출 로직 구현**
- [ ] **에러 처리 및 재시도 로직 추가**

#### 1.2 결제 생성 API 완성
- [ ] **PaymentService 하드코드 수수료 계산 제거**
- [ ] **제휴사별 수수료 정책 조회 로직 구현**
- [ ] **FeeCalculator에 HALF_UP 반올림 적용**
- [ ] **PaymentController POST /api/v1/payments 완성**
- [ ] **결제 승인 → 수수료 계산 → 저장 플로우 검증**

#### 1.3 결제 내역 조회 API 구현
- [ ] **QueryPaymentsService 구현 완성**
- [ ] **PaymentController GET /api/v1/payments 완성**
- [ ] **쿼리 파라미터 처리 (partnerId, status, from, to, cursor, limit)**
- [ ] **응답 DTO 설계 (items, summary, nextCursor, hasNext)**

#### 1.4 커서 기반 페이지네이션 구현
- [ ] **Cursor 클래스 설계 및 구현**
- [ ] **정렬 키 기반 페이지네이션 (createdAt desc, id desc)**
- [ ] **다음 페이지 존재 여부 판단 로직**
- [ ] **커서 인코딩/디코딩 로직**

#### 1.5 통계 기능 구현
- [ ] **PaymentSummaryFilter 구현**
- [ ] **PaymentSummaryProjection 구현**
- [ ] **필터와 동일한 집합 대상 통계 계산**
- [ ] **count, totalAmount, totalNetAmount 집계**

---

### 🛠️ **2단계: 데이터베이스 및 영속성**

#### 2.1 데이터베이스 스키마 최적화
- [ ] **sql/scheme.sql 검토 및 보완**
- [ ] **인덱스 최적화 (payment 테이블)**
- [ ] **JPA 엔티티 매핑 검증**
- [ ] **필요시 마이그레이션 스크립트 작성**

#### 2.2 영속성 어댑터 구현
- [ ] **PaymentPersistenceAdapter 완성**
- [ ] **커서 페이지네이션 쿼리 구현**
- [ ] **통계 집계 쿼리 구현**
- [ ] **제휴사별 수수료 정책 조회 쿼리**

#### 2.3 초기 데이터 설정
- [ ] **DataInitializer에 제휴사 시드 데이터 추가**
- [ ] **제휴사별 수수료 정책 시드 데이터 추가**
- [ ] **테스트용 결제 데이터 추가**

---

### 🧪 **3단계: 테스트 구현**

#### 3.1 도메인 테스트
- [ ] **FeeCalculator 단위 테스트**
- [ ] **Payment 도메인 모델 테스트**
- [ ] **Partner, FeePolicy 도메인 테스트**

#### 3.2 애플리케이션 서비스 테스트
- [ ] **PaymentService 단위 테스트**
- [ ] **QueryPaymentsService 단위 테스트**
- [ ] **Mock 객체를 활용한 포트 테스트**

#### 3.3 인프라 테스트
- [ ] **PG 클라이언트 어댑터 테스트**
- [ ] **데이터베이스 페르시스턴스 어댑터 테스트**
- [ ] **JPA 리포지토리 테스트**

#### 3.4 통합 테스트
- [ ] **PaymentController 통합 테스트**
- [ ] **전체 결제 플로우 통합 테스트**
- [ ] **커서 페이지네이션 통합 테스트**

---

### 🔒 **4단계: 보안 및 품질**

#### 4.1 보안 처리
- [ ] **카드번호 마스킹 검증**
- [ ] **민감정보 로깅 방지 확인**
- [ ] **입력값 검증 및 예외 처리**

#### 4.2 코드 품질
- [ ] **ktlint 코드 스타일 검사 통과**
- [ ] **코드 리뷰 및 리팩터링**
- [ ] **KDoc 문서화**

#### 4.3 성능 최적화
- [ ] **쿼리 성능 분석**
- [ ] **인덱스 효율성 검증**
- [ ] **메모리 사용량 최적화**

---

### 🚀 **5단계: 배포 및 검증**

#### 5.1 빌드 및 실행
- [ ] **전체 프로젝트 빌드 성공**
- [ ] **애플리케이션 정상 실행 확인**
- [ ] **API 엔드포인트 동작 검증**

#### 5.2 최종 테스트
- [ ] **결제 생성 시나리오 테스트**
- [ ] **결제 조회 및 페이지네이션 테스트**
- [ ] **통계 계산 정확성 검증**
- [ ] **에러 케이스 처리 검증**

---

## 🎯 **선택 과제 (가산점)**

### 추가 기능 구현
- [ ] **추가 제휴사 연동 (Adapter 추가)**
- [ ] **오픈API 문서화 (springdoc)**
- [ ] **운영지표 및 로깅**
- [ ] **MariaDB 외부 DB 전환**
- [ ] **Docker 컨테이너화**

---

## 📝 **개발 가이드라인**

### 아키텍처 원칙
- ✅ **헥사고널 아키텍처 유지**
- ✅ **포트-어댑터 패턴 준수**
- ✅ **의존성 역전 원칙 적용**
- ✅ **도메인 계층 순수성 유지**

### 코딩 스타일
- ✅ **Kotlin 코딩 컨벤션 준수**
- ✅ **ktlint 자동 포맷팅 적용**
- ✅ **의미있는 네이밍 사용**
- ✅ **적절한 KDoc 문서화**

### 테스트 원칙
- ✅ **빠르고 결정적인 테스트**
- ✅ **높은 테스트 커버리지**
- ✅ **단위/통합/엔드투엔드 테스트 균형**
- ✅ **Mock 객체 적절한 활용**

---

## 🚨 **주의사항**

1. **프로젝트가 현재 정상 동작하지 않음** - 모든 기능을 처음부터 구현해야 함
2. **질문 불가** - 문서와 코드만으로 해결해야 함
3. **면접 코드리뷰** - 깔끔한 커밋 히스토리와 코드 품질 중요
4. **아키텍처 일관성** - 모듈 경계와 의존성 방향 준수 필수

---

*마지막 업데이트: 2025년 1월 27일*
